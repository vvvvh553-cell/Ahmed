<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مولد الشعارات الفوري</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&family=Changa:wght@600;800&family=Lemonada:wght@700&family=Reem+Kufi:wght@700&family=Tajawal:wght@800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

    <style>
        :root {
            --dark-bg: #121418;
            --card-bg: #1a1d24;
            --primary-blue: #3b82f6;
            --primary-yellow: #f59e0b;
            --text-light: #e5e7eb;
            --text-muted: #9ca3af;
            --border-color: #374151;
        }
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-light);
            margin: 0;
            text-align: center;
        }
        .main-wrapper {
            padding: 20px;
            padding-top: 80px;
        }
        .container { max-width: 700px; margin: 20px auto; padding: 20px; background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 15px; }
        h1 { font-size: 2.2rem; font-weight: 800; color: var(--primary-blue); margin-bottom: 10px; }
        h2 { font-size: 1.6rem; font-weight: 700; color: var(--text-light); border-bottom: 2px solid var(--primary-blue); padding-bottom: 10px; margin-top: 30px; }
        p { color: var(--text-muted); font-size: 1rem; }
        #input-section { margin-top: 30px; }
        #company-name-input { width: 70%; padding: 12px; font-size: 1.1rem; border-radius: 8px; border: 2px solid var(--border-color); background-color: var(--dark-bg); color: var(--text-light); text-align: center; margin-bottom: 15px; }
        
        #logos-container { margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; padding: 10px; }
        .logo-card { background-color: var(--dark-bg); border: 2px solid var(--border-color); border-radius: 10px; padding: 20px; display: flex; flex-direction: column; gap: 15px; justify-content: center; align-items: center; height: auto; min-height: 150px; cursor: pointer; transition: all 0.3s ease; opacity: 0; transform: translateY(20px); animation: fadeIn 0.5s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        .logo-card:hover, .logo-card.selected { transform: translateY(-5px); border-color: var(--primary-blue); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.2); }
        .logo-card i { font-size: 2.5rem; pointer-events: none; }
        .logo-card span { font-size: 1.8rem; pointer-events: none; }

        .customization-panel { background-color: var(--dark-bg); padding: 15px; margin-top: 20px; border-radius: 8px; border: 1px solid var(--border-color); }
        .palette { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 10px; }
        .color-box { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid var(--border-color); transition: transform 0.2s; }
        .color-box:hover { transform: scale(1.1); }
        .icons-palette { display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 15px; margin-top: 10px; max-height: 150px; overflow-y: auto; padding: 10px; }
        .icon-box { font-size: 1.8rem; cursor: pointer; color: var(--text-muted); transition: all 0.2s ease; }
        .icon-box:hover { color: var(--primary-blue); transform: scale(1.2); }
        .control-group { margin-bottom: 15px; display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .control-group label { font-size: 0.9rem; color: var(--text-muted); }
        #font-size-slider { width: 80%; cursor: pointer; }
        .button-group { display: flex; gap: 10px; }

        #download-options { display: flex; gap: 20px; justify-content: center; margin-top: 20px; }
        .download-card { background-color: var(--dark-bg); border: 2px solid var(--border-color); border-radius: 10px; padding: 20px; width: 45%; cursor: pointer; transition: all 0.3s ease; }
        .download-card.unlocked { border-color: var(--primary-yellow); }
        .download-card.unlocked:hover { box-shadow: 0 0 15px rgba(245, 158, 11, 0.3); }
        .download-card h3 { margin-top: 0; color: var(--text-light); }
        
        #adgem-offerwall-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); display: none; justify-content: center; align-items: center; z-index: 2000; }
        #adgem-offerwall-content { background-color: var(--card-bg); padding: 20px; border-radius: 15px; width: 90%; max-width: 500px; text-align: center; border: 1px solid var(--border-color); }
        #adgem-offerwall-content .offer { background-color: var(--dark-bg); padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid var(--border-color); cursor: pointer; }
        #adgem-offerwall-content .offer:hover { border-color: var(--primary-yellow); }
        
        #user-info-display { position: fixed; top: 15px; left: 15px; background-color: var(--card-bg); color: var(--text-light); padding: 8px 15px; border-radius: 20px; font-size: 0.9rem; z-index: 1001; border: 1px solid var(--border-color); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        
        footer { margin-top: 40px; border-top: 1px solid var(--border-color); padding-top: 20px; }
        
        #generate-button, #close-offerwall, .button-group button { transition: all 0.3s ease; }
        #generate-button:hover, #close-offerwall:hover, .button-group button:hover { transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); }
        .loading-spinner { display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px; gap: 15px; }
        .spinner { width: 50px; height: 50px; border: 5px solid var(--border-color); border-top-color: var(--primary-blue); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- تصميم القائمة الجانبية --- */
        #menu-toggle {
            position: fixed;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            color: var(--text-light);
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 3001;
            transition: all 0.3s ease;
        }
        #menu-toggle:hover {
            background-color: var(--primary-blue);
            color: white;
        }
        #sidebar {
            position: fixed;
            top: 0;
            right: -300px; /* مخفية خارج الشاشة */
            width: 280px;
            height: 100%;
            background-color: var(--card-bg);
            box-shadow: -5px 0 15px rgba(0,0,0,0.2);
            padding: 20px;
            padding-top: 80px;
            z-index: 3000;
            transition: right 0.4s ease-in-out;
            text-align: right;
        }
        #sidebar.open {
            right: 0;
        }
        #sidebar nav a {
            display: block;
            color: var(--text-light);
            text-decoration: none;
            padding: 15px;
            font-size: 1.2rem;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }
        #sidebar nav a:hover, #sidebar nav a.active {
            background-color: var(--primary-blue);
        }
        #sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2999;
            display: none;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
        }
        #sidebar-overlay.open {
            display: block;
            opacity: 1;
        }
        .page-content {
            display: none;
        }
        .page-content.active {
            display: block;
        }
        .page-content h2 { text-align: right; }
        .page-content p, .page-content li { text-align: right; line-height: 1.8; }
        .page-content h3 { color: var(--primary-yellow); margin-top: 20px; text-align: right; }
    </style>
</head>
<body>

    <div id="menu-toggle"><i class="fa-solid fa-bars"></i></div>
    <div id="sidebar-overlay"></div>
    <div id="sidebar">
        <nav>
            <a href="#" class="nav-link active" data-page="main-content">الصفحة الرئيسية</a>
            <a href="#" class="nav-link" data-page="about-us">من نحن؟</a>
            <a href="#" class="nav-link" data-page="faq">الأسئلة الشائعة</a>
            <a href="#" class="nav-link" data-page="privacy">سياسة الخصوصية</a>
            <a href="#" class="nav-link" data-page="contact-us">اتصل بنا</a>
        </nav>
    </div>

    <div id="user-info-display">
        <span id="user-id-display"></span> | <span id="user-points-display"></span>
    </div>

    <div class="main-wrapper">
        <div id="main-content" class="page-content active">
            <div class="container">
                <header>
                    <h1>مولد الشعارات الفوري</h1>
                    <p>اصنع شعارًا احترافيًا لشركتك في 30 ثانية فقط</p>
                </header>
                <main>
                    <section id="input-section">
                        <h2>الخطوة 1: أدخل اسم شركتك</h2>
                        <input type="text" id="company-name-input" placeholder="مثال: أسود الأطلس">
                        <button id="generate-button">صمم شعاري الآن!</button>
                    </section>
                    <div id="loading-spinner" class="loading-spinner" style="display: none;">
                        <div class="spinner"></div><p>جاري توليد التصاميم...</p>
                    </div>
                    <section id="results-section" style="display: none;">
                        <h2>الخطوة 2: اختر وطور شعارك</h2>
                        <div id="logos-container"></div>
                        <div id="icons-section" class="customization-panel" style="display: none;"><p style="margin: 0 0 10px 0; color: var(--text-light);">أضف أيقونة (اختياري)</p><div class="icons-palette"></div></div>
                        <div id="customization-section" class="customization-panel" style="display: none;"><p style="margin: 0 0 10px 0; color: var(--text-light);">غيّر لون شعارك</p><div class="palette color-palette"></div></div>
                        <div id="advanced-controls-section" class="customization-panel" style="display: none;"><p style="margin: 0 0 15px 0; color: var(--text-light);">تحكم متقدم</p><div class="control-group"><label for="font-size-slider">حجم الخط:</label><input type="range" id="font-size-slider" min="1" max="3" step="0.1" value="1.8"></div><div class="control-group"><label>موضع الأيقونة:</label><div id="icon-position-buttons" class="button-group"><button data-position="top"><i class="fa-solid fa-arrow-up"></i> فوق</button><button data-position="left"><i class="fa-solid fa-arrow-left"></i> يسار</button><button data-position="right"><i class="fa-solid fa-arrow-right"></i> يمين</button></div></div></div>
                    </section>
                    <section id="download-section" style="display: none;">
                        <h2>الخطوة 3: قم بتنزيل شعارك</h2>
                        <div id="download-options"></div>
                    </section>
                </main>
            </div>
        </div>

        <div id="about-us" class="page-content container"></div>
        <div id="faq" class="page-content container"></div>
        <div id="privacy" class="page-content container"></div>
        <div id="contact-us" class="page-content container"></div>

        <footer><p>جميع الحقوق محفوظة © 2025</p></footer>
    </div>

    <div id="adgem-offerwall-overlay">
        <div id="adgem-offerwall-content">
            <h2 style="color: var(--primary-yellow); border: none;">اجمع النقاط مجانًا!</h2>
            <p>أكمل أحد هذه العروض للحصول على 200 نقطة وتنزيل شعارك بجودة عالية.</p>
            <div class="offer" onclick="simulateAdGemPostback(150, 'لعبة حرب الملوك')"><p><strong>لعبة "حرب الملوك"</strong> - قم بالوصول للمستوى 5</p><span>+ 150 نقطة</span></div>
            <div class="offer" onclick="simulateAdGemPostback(50, 'استبيان سريع')"><p><strong>أجب على استبيان سريع</strong> - 3 دقائق فقط</p><span>+ 50 نقطة</span></div>
            <button id="close-offerwall">إغلاق</button>
        </div>
    </div>

    <script>
        // --- 1. ربط عناصر HTML ---
        const companyNameInput = document.getElementById('company-name-input');
        const generateButton = document.getElementById('generate-button');
        const loadingSpinner = document.getElementById('loading-spinner');
        const resultsSection = document.getElementById('results-section');
        const logosContainer = document.getElementById('logos-container');
        const iconsSection = document.getElementById('icons-section');
        const iconsPalette = document.querySelector('.icons-palette');
        const customizationSection = document.getElementById('customization-section');
        const colorPalette = document.querySelector('.color-palette');
        const advancedControlsSection = document.getElementById('advanced-controls-section');
        const fontSizeSlider = document.getElementById('font-size-slider');
        const iconPositionButtons = document.getElementById('icon-position-buttons');
        const downloadSection = document.getElementById('download-section');
        const downloadOptions = document.getElementById('download-options');
        const adgemOverlay = document.getElementById('adgem-offerwall-overlay');
        const closeOfferwallButton = document.getElementById('close-offerwall');
        const userIdDisplay = document.getElementById('user-id-display');
        const userPointsDisplay = document.getElementById('user-points-display');
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const navLinks = document.querySelectorAll('.nav-link');
        const pageContents = document.querySelectorAll('.page-content');

        const user = { id: null, points: 0 };

        const pageData = {
            'about-us': `<h2>من نحن؟</h2><p>نحن منصة "مولد الشعارات الفوري"، مشروع وُلد من شغف بتمكين الأفكار الرائعة. نؤمن بأن كل مشروع، كبيراً كان أم صغيراً، يستحق هوية بصرية احترافية تعبر عنه.</p><p>مهمتنا هي أن نضع بين يدي رواد الأعمال والمبدعين أداة سهلة، سريعة، ومجانية لصناعة شعارات جذابة، بدون الحاجة لخبرة تقنية أو ميزانيات ضخمة. نحن هنا لنكون شرارة البداية لقصة نجاحك.</p>`,
            'faq': `<h2>الأسئلة الشائعة</h2><h3>كيف يعمل الموقع؟</h3><p>بكل بساطة! أدخل اسم شركتك، اختر النمط والأيقونة واللون الذي يعجبك، ثم قم بتنزيل شعارك. يمكنك تنزيل نسخة مجانية بجودة منخفضة، أو نسخة احترافية عالية الجودة باستخدام النقاط.</p><h3>كيف أحصل على النقاط؟</h3><p>يمكنك الحصول على النقاط مجاناً عن طريق إكمال بعض العروض البسيطة المقدمة من شركائنا (مثل تجربة لعبة أو الإجابة على استبيان). عند إكمالك للعرض، تتم إضافة النقاط إلى رصيدك تلقائياً.</p><h3>هل التنزيل الاحترافي يستحق؟</h3><p>بالتأكيد! النسخة الاحترافية تأتي كملف فيكتور (SVG)، مما يعني أنه يمكنك تكبيره لأي حجم دون فقدان الجودة، وهو مثالي للطباعة والاستخدامات التجارية.</p>`,
            'privacy': `<h2>سياسة الخصوصية</h2><p>نحن في "مولد الشعارات الفوري" نأخذ خصوصيتك على محمل الجد.</p><p><strong>المعلومات التي نجمعها:</strong> نحن لا نجمع أو نخزن أي معلومات شخصية تحدد هويتك. معرّف المستخدم (UserID) الذي يتم إنشاؤه هو عشوائي ومجهول الهوية تماماً، ويستخدم فقط لغرض وحيد وهو ربط النقاط التي تجمعها بحسابك داخل الموقع.</p><p><strong>معلومات الاتصال:</strong> إذا قمت بالاتصال بنا عبر البريد الإلكتروني أو الهاتف، فسيتم استخدام معلوماتك فقط للرد على استفسارك أو طلبك. نحن لا نشارك هذه المعلومات مع أي طرف ثالث على الإطلاق.</p><p><strong>بياناتك آمنة:</strong> كل البيانات المتعلقة بنقاطك ومعرف المستخدم يتم تخزينها محلياً على جهازك باستخدام تقنية LocalStorage في متصفحك، ولا يتم رفعها إلى أي خادم.</p>`,
            'contact-us': `<h2>اتصل بنا</h2><p>يسعدنا دائماً سماع آرائكم ومقترحاتكم، أو مساعدتكم في حال واجهتكم أي مشكلة. يمكنكم التواصل معنا عبر الوسائل التالية:</p><h3 style="text-align: center; direction: ltr;"><i class="fa-solid fa-envelope" style="color: var(--primary-yellow);"></i> ahmedroor014@gmail.com</h3><h3 style="text-align: center; direction: ltr;"><i class="fa-solid fa-phone" style="color: var(--primary-yellow);"></i> 0607072825</h3>`
        };

        document.addEventListener('DOMContentLoaded', initializeApp);

        function initializeApp() {
            user.id = localStorage.getItem('userID') || `user-${Date.now()}`;
            localStorage.setItem('userID', user.id);
            user.points = parseInt(localStorage.getItem(`points_${user.id}`) || '0');
            updateUserInfoDisplay();
            setupPageContent();
            addEventListeners();
        }

        function setupPageContent() {
            Object.keys(pageData).forEach(key => {
                const pageDiv = document.getElementById(key);
                if (pageDiv) pageDiv.innerHTML = pageData[key];
            });
        }

        function addEventListeners() {
            generateButton.addEventListener('click', generateLogos);
            closeOfferwallButton.addEventListener('click', () => { adgemOverlay.style.display = 'none'; });
            fontSizeSlider.addEventListener('input', handleFontSizeChange);
            iconPositionButtons.addEventListener('click', handleIconPositionChange);
            menuToggle.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);
            navLinks.forEach(link => link.addEventListener('click', handleNavClick));
        }

        function toggleSidebar() {
            sidebar.classList.toggle('open');
            sidebarOverlay.classList.toggle('open');
        }

        function handleNavClick(e) {
            e.preventDefault();
            const pageId = e.target.dataset.page;
            
            pageContents.forEach(content => content.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');

            navLinks.forEach(link => link.classList.remove('active'));
            e.target.classList.add('active');
            
            toggleSidebar();
        }

        function generateLogos() {
            const companyName = companyNameInput.value;
            if (companyName.trim() === '') { alert('الرجاء إدخال اسم الشركة أولاً!'); return; }
            
            logosContainer.innerHTML = '';
            ['results-section', 'icons-section', 'customization-section', 'advanced-controls-section', 'download-section'].forEach(id => document.getElementById(id).style.display = 'none');
            loadingSpinner.style.display = 'flex';

            setTimeout(() => {
                loadingSpinner.style.display = 'none';
                resultsSection.style.display = 'block';

                const styles = [
                    { fontFamily: "'Cairo', sans-serif", fontWeight: '900', color: '#e5e7eb' },
                    { fontFamily: "'Changa', sans-serif", fontWeight: '800', color: '#3b82f6', textTransform: 'uppercase' },
                    { fontFamily: "'Lemonada', cursive", fontWeight: '700', color: '#f59e0b' },
                    { fontFamily: "'Reem Kufi', sans-serif", fontWeight: '700', color: '#e5e7eb', letterSpacing: '1px' },
                    { fontFamily: "'Tajawal', sans-serif", fontWeight: '800', color: '#34d399' }
                ];

                styles.forEach((style, index) => {
                    setTimeout(() => { createLogoCard(companyName, style); }, index * 100);
                });

                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }, 1500);
        }

        function createLogoCard(text, styles) {
            const card = document.createElement('div');
            card.className = 'logo-card';
            const iconElement = document.createElement('i');
            iconElement.className = 'fa-solid fa-star';
            const textSpan = document.createElement('span');
            textSpan.textContent = text;
            Object.assign(textSpan.style, styles);
            iconElement.style.color = styles.color;
            card.appendChild(iconElement);
            card.appendChild(textSpan);
            logosContainer.appendChild(card);
            card.addEventListener('click', () => {
                document.querySelectorAll('.logo-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                showAllControls();
            });
        }

        function showAllControls() {
            showIconOptions();
            showCustomizationOptions();
            showAdvancedControls();
            showDownloadOptions();
        }

        function showIconOptions() {
            iconsSection.style.display = 'block';
            iconsPalette.innerHTML = '';
            const icons = ['fa-star', 'fa-rocket', 'fa-book-open', 'fa-car', 'fa-crown', 'fa-shield-halved', 'fa-lightbulb', 'fa-gem', 'fa-bolt', 'fa-globe', 'fa-anchor', 'fa-leaf'];
            icons.forEach(iconClass => {
                const iconBox = document.createElement('i');
                iconBox.className = `icon-box fa-solid ${iconClass}`;
                iconBox.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const selectedLogoCard = document.querySelector('.logo-card.selected');
                    if (selectedLogoCard) selectedLogoCard.querySelector('i').className = `fa-solid ${iconClass}`;
                });
                iconsPalette.appendChild(iconBox);
            });
        }

        function showCustomizationOptions() {
            customizationSection.style.display = 'block';
            colorPalette.innerHTML = '';
            const colors = ['#ef4444', '#f97316', '#84cc16', '#22c55e', '#06b6d4', '#8b5cf6', '#ec4899', '#ffffff', '#f59e0b'];
            colors.forEach(color => {
                const colorBox = document.createElement('div');
                colorBox.className = 'color-box';
                colorBox.style.backgroundColor = color;
                colorBox.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const selectedLogoCard = document.querySelector('.logo-card.selected');
                    if (selectedLogoCard) {
                        const newColor = e.target.style.backgroundColor;
                        selectedLogoCard.querySelector('span').style.color = newColor;
                        selectedLogoCard.querySelector('i').style.color = newColor;
                    }
                });
                colorPalette.appendChild(colorBox);
            });
        }

        function showAdvancedControls() { advancedControlsSection.style.display = 'block'; }

        function showDownloadOptions() {
            downloadSection.style.display = 'block';
            const canAfford = user.points >= 200;
            downloadOptions.innerHTML = `
                <div class="download-card" id="free-download"><h3>تنزيل مجاني</h3><p>(صورة PNG)</p></div>
                <div class="download-card premium ${canAfford ? 'unlocked' : ''}" id="premium-download"><h3>تنزيل احترافي</h3><p>(ملف فيكتور عالي الجودة - 200 نقطة)</p></div>
            `;
            document.getElementById('free-download').addEventListener('click', downloadFreeLogo);
            document.getElementById('premium-download').addEventListener('click', () => {
                if (canAfford) {
                    handleTransaction(user.id, -200, "شراء شعار احترافي");
                    alert("تهانينا! تم خصم النقاط. سيتم تفعيل التنزيل الاحترافي قريباً.");
                } else {
                    adgemOverlay.style.display = 'flex';
                }
            });
            downloadSection.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }

        function handleFontSizeChange(e) {
            const selectedLogoCard = document.querySelector('.logo-card.selected');
            if (selectedLogoCard) selectedLogoCard.querySelector('span').style.fontSize = `${e.target.value}rem`;
        }

        function handleIconPositionChange(e) {
            const button = e.target.closest('button');
            if (!button) return;
            const position = button.dataset.position;
            const selectedLogoCard = document.querySelector('.logo-card.selected');
            if (selectedLogoCard) {
                selectedLogoCard.style.gap = (position === 'top') ? '15px' : '10px';
                selectedLogoCard.style.flexDirection = (position === 'top') ? 'column' : (position === 'left' ? 'row-reverse' : 'row');
            }
        }

        function downloadFreeLogo() {
            const selectedLogoCard = document.querySelector('.logo-card.selected');
            if (!selectedLogoCard) return;
            html2canvas(selectedLogoCard, { backgroundColor: null, logging: false }).then(canvas => {
                const link = document.createElement('a');
                link.download = `logo-${companyNameInput.value.trim().replace(/ /g, '-')}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        function updateUserInfoDisplay() {
            userIdDisplay.textContent = `ID: ${user.id.substring(0, 12)}...`;
            userPointsDisplay.textContent = `النقاط: ${user.points}`;
        }

        function simulateAdGemPostback(points, offerName) {
            handleTransaction(user.id, points, `إكمال عرض: ${offerName}`);
            adgemOverlay.style.display = 'none';
        }

        function handleTransaction(userId, pointsChange, reason) {
            let currentPoints = parseInt(localStorage.getItem(`points_${userId}`) || '0');
            currentPoints += pointsChange;
            localStorage.setItem(`points_${userId}`, currentPoints);
            user.points = currentPoints;
            updateUserInfoDisplay();
            showDownloadOptions();
            alert(`تم تحديث رصيدك. السبب: ${reason}. الرصيد الجديد: ${currentPoints}`);
        }
    </script>

</body>
</html>
